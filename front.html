<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PharmaRetail - E-commerce Platform</title>
    <style>
        /* General Reset and Font */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }

        body {
            background-color: #f4f4f9;
        }

        /* Navigation Bar */
        nav {
            background-color: #007bff;
            padding: 1rem;
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
            flex-wrap: nowrap; /* Keep items in one row */
        }

        .nav-left, .nav-right {
            display: flex;
            flex-direction: row;
            gap: 0.5rem;
            list-style: none;
            flex-wrap: nowrap; /* Keep buttons/items in one row */
            align-items: center;
            flex-shrink: 0.5; /* Allow these sections to shrink if needed */
        }

        .nav-left button, .nav-right button {
            background-color: #ffffff;
            color: #007bff;
            border: 1px solid #007bff;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            font-size: 1rem;
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, transform 0.2s;
            flex-shrink: 0; /* Prevent buttons from shrinking too much */
            touch-action: manipulation; /* Improve touch responsiveness */
        }

        .nav-left button:hover, .nav-right button:hover {
            background-color: #0056b3;
            color: #ffffff;
            transform: scale(1.05);
        }

        .search-container {
            display: flex;
            align-items: center;
            background-color: #ffffff;
            border: 1px solid #007bff;
            border-radius: 5px;
            padding: 0.2rem;
            flex-shrink: 1; /* Allow search container to shrink */
        }

        .search-container input {
            border: none;
            outline: none;
            padding: 0.3rem 0.5rem;
            font-size: 1rem;
            width: 120px; /* Default width */
            flex-grow: 1; /* Allow input to grow */
            min-width: 50px; /* Minimum width for input */
        }

        .search-container button {
            background-color: transparent;
            border: none;
            padding: 0.3rem;
            cursor: pointer;
            color: #007bff;
            font-size: 1rem;
            flex-shrink: 0; /* Prevent search button from shrinking */
            touch-action: manipulation; /* Improve touch responsiveness */
        }

        .search-container button:hover {
            color: #0056b3;
            transform: none;
        }

        .nav-logo-container {
            display: flex;
            align-items: center;
            flex-grow: 1; /* Allow logo container to take available space */
            justify-content: center;
            flex-shrink: 1; /* Allow logo container to shrink */
            min-width: 80px; /* Minimum width for logo container */
        }

        .nav-logo {
            max-height: 80px;
            width: auto; /* Maintain aspect ratio */
            max-width: 100%; /* Ensure logo itself scales down */
        }

        /* Header Section */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
            background-color: #ffffff;
            margin-bottom: 2rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            flex-wrap: nowrap; /* Keep header items in one row */
        }

        .header-text-container {
            display: flex;
            flex-direction: column; /* Stack text vertically */
            align-items: center;
            flex-grow: 1; /* Allow text container to grow/shrink */
            text-align: center;
            margin: 0 1rem;
            flex-shrink: 1;
            min-width: 150px; /* Ensure text container has a minimum width */
        }

        .group-text {
            font-size: 1rem;
            color: #555;
            margin-bottom: 0.25rem;
            font-weight: bold;
            white-space: nowrap; /* Prevent text from wrapping if possible */
        }

        .header-logo-left, .header-logo-right {
            max-height: 120px;
            width: auto;
            max-width: 400px;
            margin: 0 15px;
            flex-shrink: 1; /* Allow logos to shrink */
        }

        header h1 {
            font-size: 2rem;
            color: #333;
            margin: 0;
            white-space: nowrap; /* Prevent title from wrapping if possible */
        }

        /* Product Grid - Always 3 columns */
        .product-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 1.5rem; /* Gap between products */
            justify-content: center;
            max-width: 1200px;
            margin: 0 auto;
            padding: 1rem;
        }

        .product-card {
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 8px;
            width: calc(33.33% - 1rem); /* 3 columns, accounting for gap */
            min-width: 200px; /* Prevent cards from becoming too narrow */
            padding: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 4px 5px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s;
        }

        .product-card:hover {
            transform: scale(1.05);
            box-shadow: 0 12px 19px rgba(0, 0, 0, 0.3);
        }

        .product-card img {
            width: 100%;
            height: 200px; /* Slightly reduced height for better fit in 3 columns */
            object-fit: cover;
            border-radius: 5px;
            margin-bottom: 0.75rem;
        }

        .product-card h3 {
            font-size: 1.2rem;
            margin: 0.5rem 0;
            color: #333;
            text-align: center;
        }

        .product-card p {
            font-size: 0.85rem;
            color: #666;
            margin-bottom: 0.25rem;
            text-align: center;
        }

        .product-card .price {
            font-size: 1.1rem;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 0.5rem;
        }

        .product-card .rating {
            font-size: 1rem;
            color: #ffc107;
            margin-bottom: 0.5rem;
        }

        .product-card .button-group {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .product-card button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
            touch-action: manipulation; /* Improve touch responsiveness */
            min-width: 100px; /* Ensure buttons are touch-friendly */
        }

        .product-card button:hover {
            background-color: #ebe707;
        }

        .product-card button:active {
            animation: clickEffect 0.3s ease;
        }

        @keyframes clickEffect {
            0% {
                transform: scale(1);
                background-color: #28a745;
            }
            50% {
                transform: scale(0.95);
                background-color: #1e7e34;
            }
            100% {
                transform: scale(1);
                background-color: #28a745;
            }
        }

        /* Cart Section */
        #cart {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 1rem;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            display: none; /* Hidden by default */
        }

        #cart h2 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            color: #2b2929;
        }

        #cart-items {
            list-style: none;
        }

        #cart-items li {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid #ddd;
        }

        .remove-from-cart-btn {
            background-color: #0e0d0d;
            color: rgb(247, 245, 245);
            border: none;
            padding: 0.3rem 0.6rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: background-color 0.2s ease-in-out;
            touch-action: manipulation; /* Improve touch responsiveness */
            min-width: 80px; /* Ensure touch-friendly */
        }

        .remove-from-cart-btn:hover {
            background-color: #ea081f;
        }

        #cart-total {
            font-weight: bold;
            font-size: 1.2rem;
            margin-top: 1rem;
            text-align: right;
            color: #333;
        }

        /* Footer */
        footer {
            background-color: #007bff;
            color: white;
            padding: 1rem;
            text-align: center;
            margin-top: 2rem;
        }

        footer a {
            color: white;
            text-decoration: none;
            margin: 0 0.5rem;
        }

        footer a:hover {
            text-decoration: underline;
        }

        /* Modal Styles for AI Feature */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background-color: #fff;
            padding: 2rem;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 600px;
            position: relative;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .modal-close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #333;
            touch-action: manipulation; /* Improve touch responsiveness */
        }

        .modal-title {
            font-size: 1.5rem;
            color: #007bff;
            margin-bottom: 0.5rem;
        }

        .modal-input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .modal-input-group textarea {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 1rem;
            resize: vertical;
            min-height: 80px;
        }

        .modal-button-group {
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .modal-button-group button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
            touch-action: manipulation; /* Improve touch responsiveness */
            min-width: 100px; /* Ensure touch-friendly */
        }

        .modal-button-group button:hover {
            background-color: #0056b3;
        }

        .modal-response-area {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 5px;
            padding: 1rem;
            min-height: 100px;
            font-size: 0.9rem;
            color: #333;
            overflow-y: auto;
            max-height: 200px;
            position: relative;
        }

        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: none;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #007bff;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }

        .disclaimer-text {
            font-size: 0.8rem;
            color: #777;
            margin-top: 0.5rem;
            text-align: center;
        }

        /* Responsive Design for Smartphones (6.1-6.9 inches, ~360px-430px) */
        @media (max-width: 430px) {
            /* Navigation Bar Adjustments */
            .nav-container {
                padding: 0.5rem;
                flex-wrap: nowrap;
                justify-content: space-around;
            }
            .nav-left, .nav-right {
                gap: 0.2rem;
                flex-shrink: 0.6;
            }
            .nav-left button, .nav-right button {
                font-size: 0.75rem;
                padding: 0.3rem 0.6rem;
                min-width: 50px; /* Touch-friendly size */
            }
            .search-container {
                min-width: 60px;
            }
            .search-container input {
                width: 50px;
                font-size: 0.75rem;
                padding: 0.2rem 0.3rem;
            }
            .search-container button {
                font-size: 0.75rem;
                padding: 0.2rem 0.3rem;
            }
            .nav-logo {
                max-height: 30px;
                margin: 0 0.2rem;
            }
            .nav-logo-container {
                min-width: 40px;
                flex-grow: 0.5;
            }

            /* Header Adjustments */
            header {
                flex-direction: row;
                align-items: center;
                justify-content: space-around;
                padding: 0.5rem 1rem;
            }
            .header-logo-left, .header-logo-right {
                max-height: 30px;
                margin: 0 5px;
            }
            .header-text-container {
                margin: 0 5px;
                min-width: 60px;
                flex-grow: 0.8;
            }
            header h1 {
                font-size: 1rem;
                white-space: normal;
            }
            .group-text {
                font-size: 0.6rem;
                white-space: normal;
            }

            /* Product Card Adjustments (3 columns maintained) */
            .product-grid {
                gap: 1rem;
                padding: 0.5rem;
            }
            .product-card {
                width: calc(33.33% - 0.67rem); /* 3 columns, adjusted for smaller gap */
                min-width: 100px; /* Allow smaller cards for smartphones */
                padding: 0.5rem;
                font-size: 0.65rem;
            }
            .product-card img {
                height: 80px;
            }
            .product-card h3 {
                font-size: 0.65rem;
                margin: 0.3rem 0;
            }
            .product-card p {
                font-size: 0.6rem;
                margin-bottom: 0.2rem;
            }
            .product-card .price, .product-card .rating {
                font-size: 0.65rem;
            }
            .product-card button {
                padding: 0.3rem 0.5rem;
                font-size: 0.65rem;
                min-width: 60px; /* Touch-friendly */
            }

            /* Cart Section Adjustments */
            #cart {
                margin: 1rem auto;
                padding: 0.5rem;
            }
            #cart h2 {
                font-size: 1.2rem;
            }
            #cart-items li {
                font-size: 0.7rem;
                padding: 0.3rem 0;
            }
            .remove-from-cart-btn {
                padding: 0.2rem 0.4rem;
                font-size: 0.7rem;
                min-width: 60px;
            }
            #cart-total {
                font-size: 0.9rem;
            }

            /* Modal Adjustments */
            .modal-content {
                padding: 1rem;
                width: 95%;
                max-width: 360px;
            }
            .modal-title {
                font-size: 1rem;
            }
            .modal-input-group textarea {
                font-size: 0.8rem;
                min-height: 60px;
            }
            .modal-button-group button {
                font-size: 0.7rem;
                padding: 0.4rem 0.8rem;
                min-width: 80px;
            }
            .modal-response-area {
                font-size: 0.7rem;
                min-height: 80px;
                max-height: 120px;
            }
            .disclaimer-text {
                font-size: 0.6rem;
            }
        }

        /* Tablet and Small Laptop Adjustments (unchanged from original) */
        @media (min-width: 431px) and (max-width: 768px) {
            .nav-container {
                padding: 0.5rem;
                flex-wrap: nowrap;
                justify-content: space-around;
            }
            .nav-left, .nav-right {
                gap: 0.3rem;
                flex-shrink: 0.5;
            }
            .nav-left button, .nav-right button {
                font-size: 0.8rem;
                padding: 0.3rem 0.6rem;
            }
            .search-container {
                min-width: 70px;
            }
            .search-container input {
                width: 60px;
                font-size: 0.8rem;
                padding: 0.2rem 0.3rem;
            }
            .search-container button {
                font-size: 0.8rem;
                padding: 0.2rem 0.3rem;
            }
            .nav-logo {
                max-height: 35px;
                margin: 0 0.3rem;
            }
            .nav-logo-container {
                min-width: 50px;
                flex-grow: 1;
            }

            header {
                flex-direction: row;
                align-items: center;
                justify-content: space-around;
                padding: 0.5rem 1rem;
            }
            .header-logo-left, .header-logo-right {
                max-height: 40px;
                margin: 0 5px;
            }
            .header-text-container {
                margin: 0 5px;
                min-width: 80px;
                flex-grow: 1;
            }
            header h1 {
                font-size: 1.2rem;
                white-space: normal;
            }
            .group-text {
                font-size: 0.7rem;
                white-space: normal;
            }

            .product-card {
                width: calc(33.33% - 1rem);
                min-width: 150px;
                padding: 0.7rem;
                font-size: 0.75rem;
            }
            .product-card img {
                height: 100px;
            }
            .product-card h3 {
                font-size: 0.8rem;
                margin: 0.4rem 0;
            }
            .product-card p {
                font-size: 0.7rem;
                margin-bottom: 0.3rem;
            }
            .product-card .price, .product-card .rating {
                font-size: 0.8rem;
            }
            .product-card button {
                padding: 0.4rem 0.6rem;
                font-size: 0.75rem;
                min-width: 80px;
            }

            .modal-content {
                padding: 1rem;
                width: 95%;
            }
            .modal-title {
                font-size: 1.2rem;
            }
            .modal-input-group textarea {
                font-size: 0.9rem;
                min-height: 60px;
            }
            .modal-button-group button {
                font-size: 0.8rem;
                padding: 0.5rem 1rem;
            }
            .modal-response-area {
                font-size: 0.8rem;
                min-height: 80px;
                max-height: 150px;
            }
            .disclaimer-text {
                font-size: 0.7rem;
            }
        }
    </style>
</head>
<body>
    <nav>
        <div class="nav-container">
            <ul class="nav-left">
                <!-- Home button links to index.html -->
                <li><button onclick="window.location.href='index.html'">Home</button></li>
                <!-- Products button (which acts as your Shop Now) links to front.html -->
                <li><button onclick="window.location.href='front.html'">Products</button></li>
                <li><button onclick="showCart()">Cart</button></li>
            </ul>

            <div class="nav-logo-container">
                <!-- Navigation logo also links to index.html -->
                <a href="index.html" class="nav-logo-link">
                    <img src="imagefolder/loogo.jpg" alt="PharmaRetail Navigation Logo" class="nav-logo">
                </a>
            </div>
            <ul class="nav-right">
                <li>
                    <div class="search-container">
                        <input type="text" id="searchInput" placeholder="Search products..." oninput="searchProducts()">
                        <button>🔍</button>
                    </div>
                </li>
                <li><button onclick="alert('Login clicked')">Login</button></li>
                <li><button onclick="alert('Logout clicked')">Logout</button></li>
            </ul>
        </div>
    </nav>

    <header>
        <img src="imagefolder/logo 002.jpg" alt="PharmaRetail Logo Left" class="header-logo-left">
        <div class="header-text-container">
            <div class="group-text">(GROUP-2)</div>
            <h1>Sky Healthcare - Quality Medications</h1>
        </div>
        <img src="imagefolder/logo001.jpg" alt="PharmaRetail Logo Right" class="header-logo-right">
    </header>

    <section id="products" class="product-grid">
        <!-- Products will be displayed here by JavaScript for the front page -->
    </section>

    <section id="cart">
        <h2>Shopping Cart</h2>
        <ul id="cart-items"></ul>
        <div id="cart-total">Total: $0.00</div>
    </section>

    <footer>
        <p>Contact us: info@pharmaretail.com | Phone: +1-800-555-1234</p>
        <p><a href="#privacy">Privacy Policy</a> | <a href="#terms">Terms of Service</a></p>
        <p>© 2025 PharmaRetail. All rights reserved.</p>
    </footer>

    <!-- AI Product Info Modal -->
    <div id="productInfoModal" class="modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" onclick="closeProductInfoModal()">✖</button>
            <h3 class="modal-title" id="modalProductTitle"></h3>
            <div class="modal-input-group">
                <textarea id="aiQuestionInput" placeholder="Ask a question about this product (e.g., 'What are its common uses?', 'Are there any food interactions?')..."></textarea>
                <div class="modal-button-group">
                    <button onclick="askAIAboutProduct()">✨ Ask AI ✨</button>
                </div>
            </div>
            <div class="modal-response-area" id="aiResponseArea">
                <div class="loading-indicator" id="aiLoadingIndicator"></div>
                <!-- AI response will appear here -->
            </div>
            <p class="disclaimer-text">
                **Disclaimer:** Information provided by AI is for general knowledge only and should not be considered medical advice. Always consult with a qualified healthcare professional for medical concerns.
            </p>
        </div>
    </div>

    <script>
        // Sample product data
        const products = [
            { id: 1, name: "Paracetamol 500mg", description: "Pain reliever and fever reducer", price: 5.99, image: "imagefolder/PARACETAMOL SYRUP (FOR KIDS).jpg", rating: 4.5 },
            { id: 2, name: "Ibuprofen 200mg", description: "Anti-inflammatory and pain relief", price: 7.49, image: "imagefolder/ACTIFED DRY COUGH & COLD SYRUP.jpg", rating: 4.6 },
            { id: 3, name: "Amoxicillin 250mg", description: "Antibiotic for bacterial infections", price: 12.99, image: "imagefolder/ACTIFED SYRUP COLD.jpg", rating: 4.8 },
            { id: 4, name: "Cetirizine 10mg", description: "Antihistamine for allergies", price: 9.99, image: "imagefolder/AGUE NIL SYRUP.jpg", rating: 4.5 },
            { id: 5, name: "Aspirin 325mg", description: "Pain relief and anti-inflammatory", price: 6.49, image: "imagefolder/AMODIAQUINE SUSPENSION ANTI-MALARIA 50mg.jpg", rating: 4.9 },
            { id: 6, name: "Loratadine 10mg", description: "Non-drowsy allergy relief", price: 8.99, image: "imagefolder/ANTACID CALCIUM CARBONATE 750mg.jpg", rating: 4.8 },
            { id: 7, name: "Omeprazole 20mg", description: "Acid reflux and heartburn relief", price: 11.49, image: "imagefolder/ANTIBIOTICS 250mg.jpg", rating: 4.7 },
            { id: 8, name: "Metformin 500mg", description: "Type 2 diabetes management", price: 15.99, image: "imagefolder/ARTEMETHER 20mg & LUMEFANTRINE 120mg.jpg", rating: 4.6 },
            { id: 9, name: "Ciprofloxacin 500mg", description: "Antibiotic for infections", price: 14.29, image: "imagefolder/TOB CEE.jpg", rating: 4.6 },
            { id: 10, name: "Simvastatin 20mg", description: "Cholesterol management", price: 10.99, image: "imagefolder/BENYLIN MUCUS RELIEF.jpg", rating: 4.9 },
            { id: 11, name: "Losartan 50mg", description: "Blood pressure control", price: 13.49, image: "imagefolder/AGUE NIL SYRUP.jpg", rating: 5.0 },
            { id: 12, name: "Levothyroxine 100mcg", description: "Thyroid hormone replacement", price: 9.29, image: "imagefolder/CLOFORT 125Mmg-5ml.jpg", rating: 4.5 },
            { id: 13, name: "Azithromycin 250mg", description: "Antibiotic for bacterial infections", price: 12.79, image: "imagefolder/BENDROFLUENT CAPSULES.jpg", rating: 4.7 },
            { id: 14, name: "Prednisone 10mg", description: "Anti-inflammatory steroid", price: 8.49, image: "imagefolder/CLOFORT 500mg.jpg", rating: 4.7 },
            { id: 15, name: "Hydrochlorothiazide 25mg", description: "Diuretic for blood pressure", price: 7.99, image: "imagefolder/Entramol.jpg", rating: 4.8 },
            { id: 16, name: "Furosemide 40mg", description: "Diuretic for edema", price: 9.49, image: "imagefolder/BENYLIN MUCUS RELIEVER.jpg", rating: 4.8 },
            { id: 17, name: "Atorvastatin 40mg", description: "Cholesterol-lowering statin", price: 11.99, image: "imagefolder/FLORIDA HERBAL SUPER B-15.jpg", rating: 4.5 },
            { id: 18, name: "Lisinopril 20mg", description: "ACE inhibitor for hypertension", price: 10.49, image: "imagefolder/FORTE VITAMIN C.jpg", rating: 4.9 },
            { id: 19, name: "Metoprolol 50mg", description: "Beta blocker for heart conditions", price: 12.29, image: "imagefolder/GEBEDOL PAIN KILLER.jpg", rating: 4.6 },
            { id: 20, name: "Clarithromycin 500mg", description: "Antibiotic for infections", price: 14.99, image: "imagefolder/KOCEF-250mg.jpg", rating: 4.6 },
            { id: 21, name: "Pantoprazole 40mg", description: "Proton pump inhibitor for GERD", price: 13.79, image: "imagefolder/KOFOF.jpg", rating: 4.7 },
            { id: 22, name: "Gabapentin 300mg", description: "Neuropathic pain relief", price: 11.29, image: "imagefolder/LEMSIP MAX COLD & FLUID CAPSULES.jpg", rating: 4.9 },
        ];

        // Cart array to store items
        let cart = [];
        let currentProductForAI = null; // To store the product object for the AI modal

        // Function to display products
        function displayProducts(filteredProducts = products) {
            const productGrid = document.querySelector('.product-grid');
            productGrid.innerHTML = ''; // Clear previous products
            filteredProducts.forEach(product => {
                const productCard = document.createElement('div');
                productCard.classList.add('product-card');
                const stars = '★'.repeat(Math.floor(product.rating)) + (product.rating % 1 >= 0.5 ? '½' : '');
                productCard.innerHTML = `
                    <img src="${product.image}" alt="${product.name}">
                    <h3>${product.name}</h3>
                    <p>${product.description}</p>
                    <div class="price">$${product.price.toFixed(2)}</div>
                    <div class="rating">${stars} (${product.rating})</div>
                    <div class="button-group">
                        <button onclick="addToCart(${product.id})">Add to Cart</button>
                        <button onclick="openProductInfoModal(${product.id})">✨ Ask AI ✨</button>
                    </div>
                `;
                productGrid.appendChild(productCard);
            });
        }

        // Search functionality
        function searchProducts() {
            const searchInput = document.getElementById('searchInput').value.toLowerCase();
            const filteredProducts = products.filter(product =>
                product.name.toLowerCase().includes(searchInput) ||
                product.description.toLowerCase().includes(searchInput)
            );
            displayProducts(filteredProducts);
        }

        // Add to Cart function
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                const cartItem = cart.find(item => item.id === productId);
                if (cartItem) {
                    cartItem.quantity++;
                } else {
                    cart.push({ ...product, quantity: 1 });
                }
                updateCart(); // Update cart display immediately after adding
                alert(`${product.name} added to cart! Quantity: ${cartItem ? cartItem.quantity : 1}`); // Provide feedback
            }
        }

        // Remove from Cart function
        function removeFromCart(productId) {
            cart = cart.filter(item => item.id !== productId);
            updateCart(); // Update cart display immediately after removing
        }

        // Update Cart display and total
        function updateCart() {
            const cartItemsContainer = document.getElementById('cart-items');
            cartItemsContainer.innerHTML = ''; // Clear existing items
            let total = 0;

            if (cart.length === 0) {
                cartItemsContainer.innerHTML = '<li style="text-align: center; color: #555; font-style: italic; padding: 1rem;">EMPTY CART</li>';
                document.getElementById('cart-total').textContent = `Total: $0.00`;
                return; // Exit the function as there are no items to process
            }

            cart.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `
                    <span>${item.name} x ${item.quantity}</span>
                    <span>$${(item.price * item.quantity).toFixed(2)}</span>
                    <button class="remove-from-cart-btn" onclick="removeFromCart(${item.id})">Remove</button>
                `;
                cartItemsContainer.appendChild(li);
                total += item.price * item.quantity;
            });

            document.getElementById('cart-total').textContent = `Total: $${total.toFixed(2)}`;
        }

        // Toggle Cart visibility and scroll to cart section
        function showCart() {
            const cartSection = document.getElementById('cart');
            cartSection.style.display = cartSection.style.display === 'block' ? 'none' : 'block';

            // Ensure cart content is updated whenever it's shown
            if (cartSection.style.display === 'block') {
                updateCart();
                // Smoothly scroll to the cart section
                cartSection.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        // AI Feature Functions
        function openProductInfoModal(productId) {
            currentProductForAI = products.find(p => p.id === productId);
            if (currentProductForAI) {
                document.getElementById('modalProductTitle').textContent = `Ask about: ${currentProductForAI.name}`;
                document.getElementById('aiQuestionInput').value = ''; // Clear previous question
                document.getElementById('aiResponseArea').innerHTML = '<div class="loading-indicator" id="aiLoadingIndicator"></div>'; // Clear previous response and reset loading
                document.getElementById('aiLoadingIndicator').style.display = 'none'; // Ensure hidden initially
                document.getElementById('productInfoModal').style.display = 'flex'; // Show modal
            }
        }

        function closeProductInfoModal() {
            document.getElementById('productInfoModal').style.display = 'none'; // Hide modal
            currentProductForAI = null; // Clear current product context
        }

        async function askAIAboutProduct() {
            const questionInput = document.getElementById('aiQuestionInput');
            const aiResponseArea = document.getElementById('aiResponseArea');
            const aiLoadingIndicator = document.getElementById('aiLoadingIndicator');

            const productName = currentProductForAI ? currentProductForAI.name : "a product";
            const userQuestion = questionInput.value.trim();

            if (!userQuestion) {
                aiResponseArea.textContent = "Please enter your question.";
                return;
            }

            // Clear previous response and show loading
            aiResponseArea.textContent = '';
            aiLoadingIndicator.style.display = 'block';

            const prompt = `Provide general informational details about ${productName} based on the following question: "${userQuestion}". If the question asks for medical advice, gently state that you cannot provide medical advice and suggest consulting a healthcare professional. Keep the answer concise and informative, focusing on common knowledge for over-the-counter medication if applicable.`;

            let chatHistory = [];
            chatHistory.push({ role: "user", parts: [{ text: prompt }] });
            const payload = { contents: chatHistory };
            const apiKey = ""; // Canvas will automatically provide the API key here in runtime.

            try {
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();

                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    const text = result.candidates[0].content.parts[0].text;
                    aiResponseArea.textContent = text;
                } else {
                    aiResponseArea.textContent = "Error: Could not get a valid response from AI. Please try again.";
                    console.error("AI response structure unexpected:", result);
                }
            } catch (error) {
                aiResponseArea.textContent = "Error communicating with AI. Please check your network and try again.";
                console.error("Error calling Gemini API:", error);
            } finally {
                aiLoadingIndicator.style.display = 'none'; // Hide loading indicator
            }
        }

        // Initialize display for products and cart on page load
        document.addEventListener('DOMContentLoaded', () => {
            displayProducts(); // Display all products when the page loads
            updateCart(); // Initialize cart display (will show "EMPTY CART" if empty)
            // The cart section is hidden by default via CSS.
            // It will only show when the "Cart" button in the nav is clicked.
        });
    </script>
</body>
</html>
